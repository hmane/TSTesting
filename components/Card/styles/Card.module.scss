// ==================== Fixed Card Header Styles ====================
:global {
  .spfx-card-header-fixed {
    display: flex;
    align-items: center;
    justify-content: space-between;
    border-bottom: 1px solid var(--spfx-card-neutral-light);
    position: relative;
    background: var(--spfx-card-neutral-lighter);
    // Remove all animations and transitions that cause issues
    transition: none;

    // Header content (left side)
    .spfx-header-content {
      flex: 1;
      min-width: 0; // Allow shrinking
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
      font-weight: 600;
      line-height: 1.4;
    }

    // Header buttons container (right side)
    .spfx-header-buttons {
      display: flex;
      align-items: center;
      gap: 4px;
      flex-shrink: 0;
      margin-left: 12px;
    }

    // Clickable header behavior
    &.clickable {
      cursor: pointer;
      user-select: none;

      &:hover {
        background-color: rgba(0, 0, 0, 0.02);
      }

      // Remove the problematic active state
      &:active {
        transform: none;
      }

      &:focus {
        outline: 1px solid var(--spfx-card-theme-primary);
        outline-offset: -1px;
      }
    }

    // Size variants
    &.size-compact {
      padding: 6px 12px;
      min-height: 32px;

      .spfx-header-content {
        font-size: 13px;
        font-weight: 500;
      }

      .spfx-header-buttons {
        gap: 2px;
        margin-left: 8px;
      }
    }

    &.size-regular {
      padding: 12px 16px;
      min-height: 48px;

      .spfx-header-content {
        font-size: 16px;
        font-weight: 600;
      }
    }

    &.size-large {
      padding: 20px 24px;
      min-height: 64px;

      .spfx-header-content {
        font-size: 18px;
        font-weight: 600;
      }

      .spfx-header-buttons {
        gap: 6px;
        margin-left: 16px;
      }
    }

    // Loading state
    &.loading {
      pointer-events: none;
      opacity: 0.8;

      .spfx-header-buttons {
        opacity: 0.5;
      }
    }
  }

  // ==================== Header Variant Colors ====================
  .spfx-card-header-fixed {
    &.success {
      background: var(--spfx-card-success);
      color: var(--spfx-card-theme-white);
      border-bottom-color: rgba(255, 255, 255, 0.2);
    }

    &.error {
      background: var(--spfx-card-error);
      color: var(--spfx-card-theme-white);
      border-bottom-color: rgba(255, 255, 255, 0.2);
    }

    &.warning {
      background: var(--spfx-card-warning);
      color: var(--spfx-card-neutral-primary);
      border-bottom-color: rgba(0, 0, 0, 0.1);
    }

    &.info {
      background: var(--spfx-card-info);
      color: var(--spfx-card-theme-white);
      border-bottom-color: rgba(255, 255, 255, 0.2);
    }

    &.default {
      background: var(--spfx-card-neutral-lighter);
      color: var(--spfx-card-neutral-primary);
      border-bottom-color: var(--spfx-card-neutral-light);
    }
  }

  // ==================== Fixed Card Styles - Remove Blue Border ====================
  .spfx-card {
    // Remove all problematic animations and transitions
    transition: box-shadow 0.2s ease;

    // Normal state
    border: 1px solid var(--spfx-card-neutral-light);
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);

    // Hover state
    &:hover {
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.15);
      border-color: var(--spfx-card-neutral-tertiary);
      transform: none; // Remove transform
    }

    // REMOVE ALL PROBLEMATIC FOCUS AND HIGHLIGHT STATES
    &:focus,
    &:focus-within,
    &.highlight {
      outline: none;
      border-color: var(--spfx-card-neutral-light); // Keep normal border
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1); // Keep normal shadow
    }

    // Disabled state
    &.disabled {
      opacity: 0.6;
      pointer-events: none;
    }

    // Loading state
    &.loading {
      opacity: 0.8;
    }

    // Remove maximize placeholder styles that cause issues
    &.maximized-placeholder {
      display: none; // Hide completely to avoid duplicate restore buttons
    }
  }

  // ==================== Fixed Content Animation ====================
  .spfx-card-content {
    overflow: hidden;
    // Much simpler, smoother animation
    transition: max-height 0.25s ease-out, opacity 0.15s ease-out;

    &.collapsed {
      max-height: 0;
      opacity: 0;
    }

    &.expanded {
      max-height: 2000px;
      opacity: 1;
    }

    // Remove complex animations
    &.no-animation {
      transition: none;
    }
  }

  // ==================== Header Button Styles ====================
  .spfx-header-action-btn,
  .spfx-header-maximize-btn,
  .spfx-header-expand-btn {
    // Remove all transform animations that cause issues
    &:hover {
      transform: none !important;
    }

    &:active {
      transform: none !important;
    }

    &:focus {
      outline: 1px solid rgba(255, 255, 255, 0.5);
      outline-offset: 1px;
    }
  }

  // ==================== Maximize Modal Fix ====================
  .spfx-card-maximized-backdrop {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    z-index: 1030;
    background: rgba(0, 0, 0, 0.5);
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 0;
  }

  .spfx-card-maximized-content {
    width: 100vw;
    height: 100vh;
    background: var(--spfx-card-theme-white);
    border-radius: 0;
    box-shadow: none;
    display: flex;
    flex-direction: column;
    overflow: hidden;
    position: relative;

    // Ensure only one restore button
    .spfx-header-maximize-btn {
      display: block;
    }

    // Hide any duplicate buttons
    .spfx-card-actions .spfx-header-maximize-btn:not(:first-of-type) {
      display: none;
    }
  }

  .spfx-card-maximized-body {
    flex: 1;
    overflow: auto;
  }

  // ==================== Remove Old Action Button Styles ====================
  // Hide old separate action buttons if they still exist
  .spfx-card-actions:not(.spfx-header-buttons) {
    display: none;
  }

  // ==================== Accordion Fixes ====================
  .spfx-accordion {
    .spfx-card-header-fixed {
      &:hover {
        z-index: 2;
        position: relative;
      }
    }

    &.spfx-accordion-connected {
      .spfx-accordion-card {
        &:not(:first-child) {
          margin-top: -1px;
        }

        &:first-child .spfx-card-header-fixed {
          border-top-left-radius: var(--spfx-card-border-radius);
          border-top-right-radius: var(--spfx-card-border-radius);
        }

        &:last-child .spfx-card-header-fixed {
          border-bottom-left-radius: var(--spfx-card-border-radius);
          border-bottom-right-radius: var(--spfx-card-border-radius);
        }
      }
    }
  }

  // ==================== Mobile Responsive ====================
  @media (max-width: 768px) {
    .spfx-card-header-fixed {
      &.size-compact {
        padding: 4px 8px;
        min-height: 28px;

        .spfx-header-content {
          font-size: 12px;
        }
      }

      &.size-regular {
        padding: 8px 12px;
        min-height: 40px;

        .spfx-header-content {
          font-size: 14px;
        }
      }

      &.size-large {
        padding: 12px 16px;
        min-height: 52px;

        .spfx-header-content {
          font-size: 16px;
        }
      }

      .spfx-header-buttons {
        gap: 2px;
        margin-left: 6px;
      }
    }
  }

  // ==================== High Contrast Mode ====================
  @media (forced-colors: active) {
    .spfx-card-header-fixed {
      border-bottom: 1px solid ButtonBorder;
      background: ButtonFace;
      color: ButtonText;

      &.clickable:hover {
        background: Highlight;
        color: HighlightText;
      }

      .spfx-header-action-btn,
      .spfx-header-expand-btn,
      .spfx-header-maximize-btn {
        border: 1px solid ButtonBorder;
        background: ButtonFace;
        color: ButtonText;

        &:hover {
          background: Highlight;
          color: HighlightText;
        }
      }
    }

    .spfx-card {
      border: 2px solid ButtonBorder;
      background: ButtonFace;
      box-shadow: none;

      &:hover {
        border-color: Highlight;
        box-shadow: none;
      }
    }
  }

  // ==================== Reduce Motion ====================
  @media (prefers-reduced-motion: reduce) {
    .spfx-card-header-fixed,
    .spfx-card-content,
    .spfx-header-action-btn,
    .spfx-header-expand-btn,
    .spfx-header-maximize-btn {
      transition: none !important;
      animation: none !important;
    }

    .spfx-card {
      transition: none !important;
      transform: none !important;
    }
  }

  // ==================== Print Styles ====================
  @media print {
    .spfx-card-header-fixed {
      background: white !important;
      color: black !important;
      border-bottom: 1px solid #000 !important;
    }

    .spfx-header-buttons {
      display: none !important;
    }

    .spfx-card {
      box-shadow: none !important;
      border: 1px solid #000 !important;
    }
  }
}
